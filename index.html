<!DOCTYPE html><html lang="en-US"><head>
    <meta charset="UTF-8">
    <title>
      Presentation API
    </title>
    <style>
    @media print {
      [data-anolis-spec]::after { content:"[" attr(data-anolis-spec) "]"; font-size:.6em; vertical-align:super; text-transform:uppercase }
    }
    </style>
    <link href="http://www.w3.org/StyleSheets/TR/W3C-ED" rel="stylesheet" type="text/css">
    <style type="text/css">
    /* Note formatting taken from HTML5 spec */
    .note { border-left-style: solid; border-left-width: 0.25em; background: none repeat scroll 0 0 #E9FBE9; border-color: #52E052; }
    .note em, .warning em, .note i, .warning i { font-style: normal; }
    p.note, div.note { padding: 0.5em 2em; }
    span.note { padding: 0 2em; }
    .note p:first-child { margin-top: 0; }
    .note p:last-child { margin-bottom: 0; }
    p.note:before { content: 'NOTE: '; }

    .open-issue { border-left-style: solid; border-left-width: 0.25em; background: none repeat scroll 0 0 #fbfbe9; border-color: #faf9a5; }
    .open-issue em, .warning em, .open-issue i, .warning i { font-style: normal; }
    p.open-issue, div.open-issue { padding: 0.5em 2em; }
    span.open-issue { padding: 0 2em; }
    .open-issue p:first-child { margin-top: 0; }
    .open-issue p:last-child { margin-bottom: 0; }

    .non-normative { border-left-style: solid; border-left-width: 0.25em; background: none repeat scroll 0 0 #E9FBE9; border-color: #52E052; }
    p.non-normative:before { content: 'Non-normative: '; font-weight: bolder;}
    p.non-normative, div.non-normative { padding: 0.5em 2em; }


    /* Pre.idl formatting taken from HTML5 spec */
    pre.idl { border: solid thin #d3d3d3; background: #FCFCFC; color: black; padding: 0.5em 1em; position: relative; }
    pre.idl :link, pre.idl :visited { color: inherit; background: transparent; }
    pre.idl::before { content: "IDL"; font: bold small sans-serif;
    padding: 0.5em; background: white; position: absolute; top: 0;
    margin: -1px 0 0 -4em; width: 1.5em; border: thin solid;
    border-radius: 0 0 0 0.5em }

    /* .example idl formatting taken from HTML5 nightly spec */
    .example {
        display: block;
        color: #222222;
        background: #FCFCFC;
        border-left-style: solid;
        border-color: #c0c0c0;
        border-left-width: 0.25em;
        margin-left: 1em;
        padding-left: 1em;
        padding-bottom: 0.5em;
    }

    .algorithm li {
        margin-bottom: 0.5em;
    }

    .interface dd, .parameters dt {
        margin-bottom: 0.5em;
    }

    code { color: orangered; }
    table { border-collapse: collapse; border-style: hidden hidden none hidden; }
    table thead, table tbody { border-bottom: solid; }
    table td, table th { border-left: solid; border-right: solid; border-bottom: solid thin; vertical-align: top; padding: 0.2em; }
    dfn { font-weight: bolder; font-style: normal; }
    .copyright { font-size: small; }
    </style>
  </head>
  <body>
    <div class="head">
      
<!--begin-logo-->
<p><a href="http://www.w3.org/"><img alt="W3C" height="48" src="https://www.w3.org/Icons/w3c_home" width="72"></a></p>
<!--end-logo-->
      <h1>
        Presentation API
      </h1>
      <h2 class="no-num no-toc" id="editor's-draft-2-june-2015">
        Editor's Draft 2 June 2015
      </h2>
      <dl>
        <dt>
          This version:
        </dt>
        <dd>
          <!--begin-link--><a href="http://w3c.github.io/presentation-api/ 
          ">http://w3c.github.io/presentation-api/ 
          </a><!--end-link-->
        </dd>
        <dt>
          Latest published version:
        </dt>
        <dd>
          <!--begin-link--><a href="http://www.w3.org/TR/presentation-api/ 
          ">http://www.w3.org/TR/presentation-api/ 
          </a><!--end-link-->
        </dd>
        <dt>
          Latest editor's draft:
        </dt>
        <dd>
          <!--begin-link--><a href="http://w3c.github.io/presentation-api/ 
          ">http://w3c.github.io/presentation-api/ 
          </a><!--end-link-->
        </dd>
        <dt>
          Version history:
        </dt>
        <dd>
          <!--begin-link--><a href="https://github.com/w3c/presentation-api/commits/ 
          ">https://github.com/w3c/presentation-api/commits/ 
          </a><!--end-link-->
        </dd>
        <dt>
          Participate:
        </dt>
        <dd>
          Send feedback to <a href="https://lists.w3.org/Archives/Public/public-secondscreen/">public-secondscreen@w3.org</a>
          or <a href="https://github.com/w3c/presentation-api/issues/new">open
          a new issue</a> (<a href="https://github.com/w3c/presentation-api/issues/">open issues</a>)
        </dd>
        <dt>
          Editors:
        </dt>
        <dd>
          <a href="mailto:mfoltz@google.com">Mark Foltz</a>, Google
        </dd>
        <dd>
          Dominik Röttsches, Intel (until April 2015)
        </dd>
      </dl>
      <p class="copyright">
        <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
        © 2015 <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>,
        <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
        <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a>
        and <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document
        use</a> rules apply.
      </p>
      <hr>
    </div>
    <section>
      <h2 class="no-num no-toc" id="abstract">
        Abstract
      </h2>
      <p>
        This specification defines an API to enable web content to access
        external presentation-type displays and use them for presenting web
        content.
      </p>
    </section>
    <section>
      <h2 class="no-num no-toc" id="sotd">
        Status of This Document
      </h2>
      <p>
        <em>This section describes the status of this document at the time of
        its publication. Other documents may supersede this document. A list of
        current W3C publications and the latest revision of this technical
        report can be found in the <a href="http://www.w3.org/TR/">W3C
        technical reports index</a> at http://www.w3.org/TR/.</em>
      </p>
      <p>
        This document was published by the <a href="http://www.w3.org/2014/secondscreen/">Second Screen Presentation
        Working Group</a> as an Editor's Draft. If you wish to make comments
        regarding this document, please send them to <a href="mailto:public-secondscreen@w3.org">public-secondscreen@w3.org</a>
        (<a href="mailto:public-secondscreen-request@w3.org?subject=subscribe">subscribe</a>,
        <a href="http://lists.w3.org/Archives/Public/public-secondscreen/">archives</a>).
        All comments are welcome.
      </p>
      <p>
        This document is a <b>work in progress</b> and is subject to change. It
        builds on the <a href="http://www.w3.org/2014/secondscreen/presentation-api/20141118/" title="Presentation API W3C Community Group Final Report">final report</a>
        (dated 18 November 2014) produced by the Second Screen Presentation
        Community Group. Algorithms have been drafted in particular. Most
        sections are still incomplete or underspecified. Privacy and security
        considerations are missing. A few open issues are noted inline. Please
        check the group's <a href="https://github.com/w3c/presentation-api/issues">issue tracker</a> on
        GitHub for an accurate list. Feedback from early experimentations is
        encouraged to allow the Second Screen Presentation Working Group to
        evolve the specification based on implementation issues.
      </p>
      <p>
        Publication as a First Public Working Draft does not imply endorsement
        by the <abbr title="World Wide Web Consortium">W3C</abbr> Membership.
        This draft document may be updated, replaced or obsoleted by other
        documents at any time. It is inappropriate to cite this document as
        other than work in progress.
      </p>
      <p>
        This document was produced by a group operating under the <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/" id="sotd_patent" rel="w3p:patentRules">5 February 2004
        <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.
        <abbr title="World Wide Web Consortium">W3C</abbr> maintains a <a href="http://www.w3.org/2004/01/pp-impl/74168/status" rel="disclosure">public list of any patent disclosures</a> made in
        connection with the deliverables of the group; that page also includes
        instructions for disclosing a patent. An individual who has actual
        knowledge of a patent that the individual believes contains <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
        Claim(s)</a> must disclose the information in accordance with <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
        6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent
        Policy</a>.
      </p>
      <p>
        This document is governed by the <a href="http://www.w3.org/2014/Process-20140801/" id="w3c_process_revision">1 August 2014 <abbr title="World Wide Web Consortium">W3C</abbr> Process Document</a>.
      </p>
    </section>
    <section>
      <h2 class="no-num no-toc" id="table-of-contents">
        Table of Contents
      </h2>
<!--begin-toc-->
<ol class="toc">
 <li><a href="#introduction"><span class="secno">1 </span>
        Introduction
      </a></li>
 <li><a href="#use-cases-and-requirements-0"><span class="secno">2 </span>
        Use cases and requirements
      </a></li>
 <li><a href="#conformance"><span class="secno">3 </span>
        Conformance
      </a></li>
 <li><a href="#terminology"><span class="secno">4 </span>
        Terminology
      </a></li>
 <li><a href="#examples"><span class="secno">5 </span>
        Examples
      </a>
  <ol>
   <li><a href="#monitor-availability-of-presentation-displays-example"><span class="secno">5.1 </span>
          Monitor availability of presentation displays example
        </a></li>
   <li><a href="#starting-a-new-presentation-session-example"><span class="secno">5.2 </span>
          Starting a new presentation session example
        </a></li>
   <li><a href="#joining-a-presentation-session-example"><span class="secno">5.3 </span>
          Joining a presentation session example
        </a></li>
   <li><a href="#handling-an-event-for-a-ua-initiated-presentation-session-example"><span class="secno">5.4 </span>
          Handling an event for a UA initiated presentation session example
        </a></li>
   <li><a href="#monitor-session's-state-and-exchange-data-example"><span class="secno">5.5 </span>
          Monitor session's state and exchange data example
        </a></ol></li>
 <li><a href="#api"><span class="secno">6 </span>
        API
      </a>
  <ol>
   <li><a href="#common-idioms"><span class="secno">6.1 </span>
          Common idioms
        </a></li>
   <li><a href="#common-definitions"><span class="secno">6.2 </span>
          Common definitions
        </a></li>
   <li><a href="#interface-presentationsession"><span class="secno">6.3 </span>
          Interface <code>PresentationSession</code>
        </a>
    <ol>
     <li><a href="#sending-a-message-through-presentationsession"><span class="secno">6.3.1 </span>
            Sending a message through <code>PresentationSession</code>
          </a></li>
     <li><a href="#receiving-a-message-through-presentationsession"><span class="secno">6.3.2 </span>
            Receiving a message through <code>PresentationSession</code>
          </a></li>
     <li><a href="#closing-a-presentationsession"><span class="secno">6.3.3 </span>
            Closing a <code>PresentationSession</code>
          </a></li>
     <li><a href="#event-handlers"><span class="secno">6.3.4 </span>
            Event Handlers
          </a></ol></li>
   <li><a href="#interface-navigatorpresentation"><span class="secno">6.4 </span>
          Interface <code>NavigatorPresentation</code>
        </a>
    <ol>
     <li><a href="#starting-a-presentation-session"><span class="secno">6.4.1 </span>
            Starting a presentation session
          </a></li>
     <li><a href="#joining-a-presentation-session"><span class="secno">6.4.2 </span>
            Joining a presentation session
          </a></li>
     <li><a href="#establishing-a-presentation-connection"><span class="secno">6.4.3 </span>
            Establishing a presentation connection
          </a></li>
     <li><a href="#establishing-a-presentation-connection-on-presenting-page"><span class="secno">6.4.4 </span>
            Establishing a presentation connection on presenting page
          </a></li>
     <li><a href="#the-onavailablechange-eventhandler"><span class="secno">6.4.5 </span>
            The <code>onavailablechange</code> EventHandler
          </a>
      <ol>
       <li><a href="#adding-an-eventhandler-to-onavailablechange"><span class="secno">6.4.5.1 </span>
              Adding an <code>EventHandler</code> to
              <code>onavailablechange</code>
            </a></li>
       <li><a href="#removing-an-eventhandler"><span class="secno">6.4.5.2 </span>
              Removing an <code>EventHandler</code>
            </a></li>
       <li><a href="#monitoring-the-list-of-available-presentation-displays"><span class="secno">6.4.5.3 </span>
              Monitoring the list of available presentation displays
            </a></ol></ol></li>
   <li><a href="#interface-availablechangeevent"><span class="secno">6.5 </span>
          <span>Interface <code>AvailableChangeEvent</code></span>
        </a></li>
   <li><a href="#interface-defaultsessionstart"><span class="secno">6.6 </span>
          <span>Interface <code>DefaultSessionStart</code></span>
        </a></ol></li>
 <li><a href="#security-and-privacy-considerations"><span class="secno">7 </span>
        Security and privacy considerations
      </a></li>
 <li><a href="#references"><span class="secno">8 </span>
        References
      </a></li>
 <li><a href="#acknowledgments"><span class="secno">9 </span>
        Acknowledgments
      </a></ol>
<!--end-toc-->
    </section>
    <section>
      <h2 id="introduction"><span class="secno">1 </span>
        Introduction
      </h2><em>This section is non-normative.</em>
      <p>
        This specification aims to make secondary displays such as a projector
        or a connected TV available to the web and takes into account displays
        that are attached using wired (HDMI, DVI or similar) and wireless
        technologies (MiraCast, Chromecast, DLNA, AirPlay or similar).
      </p>
      <p>
        Devices with limited screen size lack the ability to show content to a
        larger audience, for example, a group of colleagues in a conference
        room, or friends and family at home. Showing content on an external
        large display helps to improve the perceived quality and impact of the
        presented content.
      </p>
      <p>
        At its core, this specification enables an exchange of messages between
        a requesting page and a presentation page shown in the secondary
        display. How those messages are transmitted is left to the UA in order
        to allow for the use of display devices that can be attached to a wide
        variety of ways. For example, when a display device is attached using
        HDMI or MiraCast, the UA on the requesting device can render the
        requested presentation page in that same UA. Instead of displaying in a
        window on that same device, however, it can use whatever means the
        operating system provides for using those external displays. In that
        case, both the requesting page and the presentation page run on the
        requesting device and the operating system is used to route the
        presentation display output to the other display device. The second
        display device doesn't need to know anything about this spec or that
        the content involves HTML5.
      </p>
      <p>
        Alternately, some types of external displays may be able to render
        HTML5 themselves and may have defined their way to send messages to
        that content. In that case, the UA on the requesting device would not
        need to render the presentation page itself. Instead, the UA could act
        as a proxy translating the request to show a page and the messages into
        the form understood by the display device.
      </p>
      <p>
        This way of attaching to displays could be enhanced in the future by
        defining a standard protocol for delivering these types of messages
        that display devices could choose to implement.
      </p>
      <p>
        The API defined here is intended to be used with UAs that attach to
        display devices through any of the above means.
      </p>
    </section>
    <section id="use-cases-and-requirements">
      <h2 id="use-cases-and-requirements-0"><span class="secno">2 </span>
        Use cases and requirements
      </h2>Use cases and requirements are captured in a separate <a href="https://github.com/w3c/presentation-api/blob/gh-pages/uc-req.md">Presentation
      API Use Cases and Requirements</a> document.
    </section>
    <section>
      <h2 id="conformance"><span class="secno">3 </span>
        Conformance
      </h2>
      <p>
        All diagrams, examples, and notes in this specification are
        non-normative, as are all sections explicitly marked non-normative.
        Everything else in this specification is normative.
      </p>
      <p>
        The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
        "OPTIONAL" in this document are to be interpreted as described in RFC
        2119. For readability, these words do not appear in all uppercase
        letters in this specification. <a href="#refsRFC2119">[RFC2119]</a>
      </p>
      <p>
        Requirements phrased in the imperative as part of algorithms (such as
        "strip any leading space characters" or "return false and terminate
        these steps") are to be interpreted with the meaning of the key word
        ("must", "should", "may", etc.) used in introducing the algorithm.
      </p>
      <p>
        Conformance requirements phrased as algorithms or specific steps may be
        implemented in any manner, so long as the result is equivalent. (In
        particular, the algorithms defined in this specification are intended
        to be easy to follow, and not intended to be performant.)
      </p>
    </section>
    <section>
      <h2 id="terminology"><span class="secno">4 </span>
        Terminology
      </h2>
      <p>
        The terms <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#browsing-context">browsing context</a>,
        <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#event-handlers">event handlers</a>, <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#event-handler-event-type" title="event handler event type">event handler
        event types</a>, <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/infrastructure.html#concept-event-fire" title="concept-event-fire">firing an event</a>, <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#navigate">navigate</a>, <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task" title="queue a task">queing a task</a> are defined in
        <a href="#refsHTML5">[HTML5]</a>.
      </p>
      <p>
        The term <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#domexception" title="domexception">DOMException</a> is defined in <a href="#refsDOM">[DOM]</a>.
      </p>
      <p>
        The term <a class="external" data-anolis-spec="es6" href="https://people.mozilla.org/~jorendorff/es6-draft.html#sec-promise-objects" title="promise-objects">Promise</a> is defined in <a href="#refsES6">[ES6]</a>. The terms <a class="external" data-anolis-spec="promguide" href="http://www.w3.org/2001/tag/doc/promises-guide#shorthand-manipulating" title="resolve-reject">resolving a Promise, and rejecting a Promise</a>
        are used as explained in <a href="#refsPROMGUIDE">[PROMGUIDE]</a>.
      </p>
      <p>
        The term <a class="external" data-anolis-spec="url" href="https://url.spec.whatwg.org/#url">URL</a> is defined in the
        WHATWG URL standard: <a href="#refsURL">[URL]</a>.
      </p>
      <p>
        The terms <a class="external" data-anolis-spec="typedarray" href="http://www.khronos.org/registry/typedarray/specs/latest/#5">ArrayBuffer</a>,
        <a class="external" data-anolis-spec="typedarray" href="http://www.khronos.org/registry/typedarray/specs/latest/#6">ArrayBufferView</a> are defined
        in the Typed Array specification: <a href="#refsTYPEDARRAY">[TYPEDARRAY]</a>.
      </p>
      <p>
        The term <a class="external" data-anolis-spec="fileapi" href="http://dev.w3.org/2006/webapi/FileAPI/#blob">Blob</a> is defined in the
        File API specification: <a href="#refsFILEAPI">[FILEAPI]</a>.
      </p>
      <p>
        This document provides interface definitions using the
        <a href="#refsWEBIDL">[WEBIDL]</a> standard.
      </p>
    </section>
    <section>
      <h2 id="examples"><span class="secno">5 </span>
        Examples
      </h2>
      <p class="open-issue">
        <a href="https://github.com/w3c/presentation-api/issues/42">ISSUE 42:
        Make the Example section more concise</a>
      </p>
      <p>
        This section shows example codes that highlight the usage of main
        features of the Presentation API. In these examples,
        <code>controller.html</code> implements the controller and
        <code>presentation.html</code> implements the presentation. Both pages
        are served from the domain <code>http://example.org</code>
        (<code>http://example.org/controller.html</code> and
        <code>http://example.org/presentation.html</code>). Please refer to the
        comments in the code examples for further details.
      </p>
      <section>
        <h3 id="monitor-availability-of-presentation-displays-example"><span class="secno">5.1 </span>
          Monitor availability of presentation displays example
        </h3>
        <pre class="example">&lt;!-- controller.html --&gt;
&lt;button id="castBtn" style="display: none;"&gt;Cast&lt;/button&gt;
&lt;script&gt;
  // the cast button is visible if at least one presentation display is available
  var castBtn = document.getElementById("castBtn");
  // availablechange event is fired when the presentation display availability changes
  navigator.presentation.onavailablechange = function (evt) {
    // show or hide cast button depending on display availability
    castBtn.style.display = evt.available ? "inline" : "none";
  };
&lt;/script&gt;
</pre>
      </section>
      <section>
        <h3 id="starting-a-new-presentation-session-example"><span class="secno">5.2 </span>
          Starting a new presentation session example
        </h3>
        <pre class="example">&lt;!-- controller.html --&gt;
&lt;script&gt;
  // it is also possible to use relative presentation URL e.g. "presentation.html"
  var presUrl = "http://example.com/presentation.html";
  // create random presId
  var presId = Math.random().toFixed(6).substr(2);
  // Start new session. presId is optional.
  navigator.presentation.startSession(presUrl, presId)
    // the new started session will be passed to setSession on success
    .then(setSession)
    // user cancels the selection dialog or an error is occurred
    .catch(endSession);
&lt;/script&gt;
</pre>
      </section>
      <section>
        <h3 id="joining-a-presentation-session-example"><span class="secno">5.3 </span>
          Joining a presentation session example
        </h3>
        <pre class="example">&lt;!-- controller.html --&gt;
&lt;script&gt;
  // read presId from localStorage if exists
  var presId = localStorage &amp;&amp; localStorage["presId"] || null;
  // presId is mandatory for joinSession.
  presId &amp;&amp; navigator.presentation.joinSession(presUrl, presId)
    // The joined session will be passed to setSession on success
    .then(setSession)
    // no session found for presUrl and presId or an error is occurred
    .catch(endSession);
&lt;/script&gt;
</pre>
      </section>
      <section>
        <h3 id="handling-an-event-for-a-ua-initiated-presentation-session-example"><span class="secno">5.4 </span>
          Handling an event for a UA initiated presentation session example
        </h3>
        <pre class="example">&lt;!-- controller.html --&gt;
&lt;head&gt;
  &lt;!-- the link element with rel='default-presentation' allows the page to specify --&gt;
  &lt;!-- the presentation URL and id for when the UA initiates a presentation session --&gt;
  &lt;link href="http://example.com/presentation.html" rel="default-presentation" id="ABCD1234" &gt;
&lt;/head&gt;
&lt;script&gt;
  navigator.presentation.ondefaultsessionstart = function (evt) {
    setSession(evt.session);
  };
&lt;/script&gt;

</pre>
      </section>
      <section>
        <h3 id="monitor-session's-state-and-exchange-data-example"><span class="secno">5.5 </span>
          Monitor session's state and exchange data example
        </h3>
        <pre class="example">&lt;!-- controller.html --&gt;
&lt;script&gt;
  var session;
  var setSession = function (theSession) {
    // end existing session, if any
    endSession();
    // set the new session
    session = theSession;
    if (session) {
      // save presId in localStorage
      localStorage &amp;&amp; (localStorage["presId"] = session.id);
      // monitor session's state
      session.onstatechange = function () {
        if (this == session &amp;&amp; this.state == "disconnected")
          endSession();
      };
      // register message handler
      session.onmessage = function (evt) {
        console.log("receive message", evt.data);
      };
      // send message to presentation page
      session.send("say hello");
    }
  };
  var endSession = function () {
    // close old session if exists
    session &amp;&amp; session.close();
    // remove old presId from localStorage if exists
    localStorage &amp;&amp; delete localStorage["presId"];
  };
&lt;/script&gt;
</pre>
        <pre class="example">&lt;!-- presentation.html --&gt;
&lt;script&gt;
  var session = navigator.presentation.session;
  session.onstatechange = function () {
    // session.state is either 'connected' or 'disconnected'
    console.log("session's state is now", session.state);
  };
  session.onmessage = function (evt) {
    if (evt.data == "say hello")
      session.send("hello");
  };
&lt;/script&gt;
</pre>
      </section>
    </section>
    <section>
      <h2 id="api"><span class="secno">6 </span>
        API
      </h2>
      <section>
        <h3 id="common-idioms"><span class="secno">6.1 </span>
          Common idioms
        </h3>
        <p>
          A <dfn id="presentation-display">presentation display</dfn> refers to an external screen
          available to the user agent via an implementation specific connection
          technology.
        </p>
        <p>
          A <dfn id="presentation-session">presentation session</dfn> is an object relating an
          <a href="#controlling-browsing-context">controlling browsing context</a> to its <a href="#presenting-browsing-context">presenting
          browsing context</a> and enables two-way-messaging between them.
          Each presentation session has a <dfn id="presentation-session-state">presentation session state</dfn>
          and a <dfn id="presentation-session-identifier">presentation session identifier</dfn> to distinguish it
          from other <span>presentation sessions</span>.
        </p>
        <p>
          An <dfn id="controlling-browsing-context">controlling browsing context</dfn> (or <em>controller</em>
          for short) is a <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#browsing-context">browsing
          context</a> that has initiated or resumed a <a href="#presentation-session">presentation
          session</a> by calling <code><a href="#startsession">startSession</a>()</code> or
          <code><a href="#joinsession">joinSession</a>()</code> or received a
          <a href="#presentation-session">presentation session</a> via
          <code><span>ondefaultsessionstart</span></code> event.
        </p>
        <p>
          The <dfn id="presenting-browsing-context">presenting browsing context</dfn> (or <em>presentation</em>
          for short) is the browsing context responsible for rendering to a
          <a href="#presentation-display">presentation display</a>. A <a href="#presenting-browsing-context">presenting browsing
          context</a> can reside in the same user agent as the
          <a href="#controlling-browsing-context">controlling browsing context</a> or a different one.
        </p>
      </section>
      <section>
        <h3 id="common-definitions"><span class="secno">6.2 </span>
          Common definitions
        </h3>
        <p>
          Let <em>D</em> be the set of presentations that are currently known
          to the user agent (regardles of their state). <em>D</em> is
          represented as a set of tuples <em>(U, I, S)</em> where <em>U</em> is
          the <a class="external" data-anolis-spec="url" href="https://url.spec.whatwg.org/#url">URL</a> that is being presented;
          <em>I</em> is an alphanumeric identifier for the presentation; and
          <em>S</em> is the user agent's <a href="#presentationsession"><code>PresentationSession</code></a> for
          the presentation. <em>U</em> and <em>I</em> together uniquely
          identify the <a href="#presentationsession"><code>PresentationSession</code></a> of the corresponding
          presentation.
        </p>
      </section>
      <section>
        <h3 id="interface-presentationsession"><span class="secno">6.3 </span>
          Interface <a href="#presentationsession"><code>PresentationSession</code></a>
        </h3>
        <p>
          Each <span title="concept-presentation-session">presentation
          session</span> is represented by a <a href="#presentationsession"><code>PresentationSession</code></a>
          object.
        </p>
        <pre class="idl">enum <dfn id="presentationsessionstate">PresentationSessionState</dfn> { "connected", "disconnected" /*, "resumed" */ };
enum <dfn id="binarytype">BinaryType</dfn> { "blob", "arraybuffer" };

interface <dfn id="presentationsession">PresentationSession</dfn> : EventTarget {
  readonly <a class="external" data-anolis-spec="webidl" href="http://heycam.github.io/webidl/#idl-DOMString">DOMString</a>? <a href="#id">id</a>;
  readonly attribute <a href="#presentationsessionstate">PresentationSessionState</a> <a href="#state">state</a>;
  void <a href="#close">close</a>();
  attribute <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#eventhandler">EventHandler</a> <a href="#onstatechange">onstatechange</a>;

  // Communication
  attribute BinaryType <dfn id="binarytype-attribute" title="binarytype-attribute">binaryType</dfn>;
  <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#eventhandler">EventHandler</a> <dfn id="presentation-onmessage" title="presentation-onmessage">onmessage</dfn>;
  void <dfn id="send">send</dfn> (<a class="external" data-anolis-spec="webidl" href="http://heycam.github.io/webidl/#idl-DOMString">DOMString</a> message);
  void <dfn id="send-blob" title="send-blob">send</dfn> (<a class="external" data-anolis-spec="fileapi" href="http://dev.w3.org/2006/webapi/FileAPI/#blob">Blob</a> data);
  void <dfn id="send-arraybuffer" title="send-arraybuffer">send</dfn> (<a class="external" data-anolis-spec="typedarray" href="http://www.khronos.org/registry/typedarray/specs/latest/#5">ArrayBuffer</a> data);
  void <dfn id="send-arraybufferview" title="send-arraybufferview">send</dfn> (<a class="external" data-anolis-spec="typedarray" href="http://www.khronos.org/registry/typedarray/specs/latest/#6">ArrayBufferView</a> data);
};
</pre>
        <p>
          The <dfn id="id"><code>id</code></dfn> attribute holds the alphanumeric
          <a href="#presentation-session-identifier">presentation session identifier</a>.
        </p>
        <p>
          The <dfn id="state"><code>state</code></dfn> attribute represents the
          <a href="#presentation-session">presentation session</a>'s current state. It can take one of
          the values of <a href="#presentationsessionstate"><code>PresentationSessionState</code></a>
          depending on connection state.
        </p>
        <p>
          When the <code><a href="#send">send</a>()</code> method is called on a
          <a href="#presentationsession"><code>PresentationSession</code></a> object with a <code>message</code>,
          the user agent must run the algorithm to <a href="#algorithm-send" title="algorithm-send">send a message through a
          <span><code>PresentationSession</code></span></a>.
        </p>
        <p>
          When the <code><dfn id="close">close</dfn>()</code> method is called on a
          <a href="#presentationsession"><code>PresentationSession</code></a>, the user agent must run the
          algorithm to <a href="#close-algorithm" title="close-algorithm">close a presentation
          session</a>.
        </p>
        <p class="open-issue">
          <a href="https://github.com/w3c/presentation-api/issues/34">ISSUE 34:
          Specify the presentation initialization algorithm</a>
        </p>
        <section>
          <p class="open-issue">
            <a href="https://github.com/w3c/presentation-api/issues/46">ISSUE
            46: Define send behavior</a>
          </p>
          <h4 id="sending-a-message-through-presentationsession"><span class="secno">6.3.1 </span>
            Sending a message through <a href="#presentationsession"><code>PresentationSession</code></a>
          </h4>
          <p class="note">
            Presentation API does not mandate a specific protocol for the
            connection between the <a href="#controlling-browsing-context">controlling browsing context</a>
            and the <a href="#presenting-browsing-context">presenting browsing context</a> except that for
            multiple calls to <a href="#send"><code>send</code></a> it has to be ensured that
            messages are delivered to the other end in sequence.
          </p>
          <p>
            Let <dfn id="presentation-message-data">presentation message data</dfn> be the payload data to be
            transmitted between two browsing contexts. Let <dfn id="presentation-message-type">presentation
            message type</dfn> be the type of that data, one of
            <code>text</code> and <code>binary</code>.
          </p>
          <p>
            When the user agent is to <dfn id="algorithm-send" title="algorithm-send">send a
            message through a <code>PresentationSession</code> S</dfn>, it must
            run the following steps:
          </p>
          <ol>
            <li>If the <a href="#state"><code>state</code></a> property of
            <a href="#presentationsession"><code>PresentationSession</code></a> is <code>"disconnected"</code>,
            throw an <code>InvalidStateError</code> exception.
            </li>
            <li>Let <a href="#presentation-message-type">presentation message type</a> <em>messageType</em>
            be <code>binary</code> if <code>data</code> is one of
            <code>ArrayBuffer</code> or <code>Blob</code>. Let
            <em>messageType</em> be <code>text</code> if <code>data</code> is
            of type <code>DOMString</code>)
            </li>
            <li>Assign the <dfn id="destination-browsing-context">destination browsing context</dfn> as follows:
              <ol>
                <li>Let the the <a href="#destination-browsing-context">destination browsing context</a> be
                the <a href="#controlling-browsing-context">controlling browsing context</a> if
                <a href="#send">send</a> is called in the <a href="#presenting-browsing-context">presenting browsing
                context</a>.
                </li>
                <li>Let <a href="#destination-browsing-context">destination browsing context</a> be the <a href="#presenting-browsing-context">
                  presenting browsing context</a> if <a href="#send">send</a> is
                  called from the <span>opening browsing context</span>.
                </li>
              </ol>
            </li>
            <li>Using an implementation specific mechanism, transmit the
            contents of the <code>data</code> argument as <a href="#presentation-message-data">presentation
            message data</a> and <a href="#presentation-message-type">presentation message type</a> <em>
              messageType</em> to the <a href="#destination-browsing-context">destination browsing context</a>
              side.
            </li>
          </ol>
        </section>
        <section>
          <h4 id="receiving-a-message-through-presentationsession"><span class="secno">6.3.2 </span>
            Receiving a message through <a href="#presentationsession"><code>PresentationSession</code></a>
          </h4>
          <p>
            When the user agent has received a transmission from the remote
            side consisting of <a href="#presentation-message-data">presentation message data</a> and
            <a href="#presentation-message-type">presentation message type</a>, it must run the following
            steps:
          </p>
          <ol>
            <li>If the <a href="#state"><code>state</code></a> property of
            <a href="#presentationsession"><code>PresentationSession</code></a> is <code>"disconnected"</code>,
            abort these steps.
            </li>
            <li>Let <em>event</em> be a newly created <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/infrastructure.html#concept-events-trusted" title="concept-events-trusted">trusted event</a> that
            uses the <code>MessageEvent</code> interface, with the event type
            <code>message</code>, which does not bubble, is not cancelable, and
            has no default action.
            </li>
            <li>Initialize the <em>event's</em> data attribute as follows:
              <ol>
                <li>If the <a href="#presentation-message-type">presentation message type</a> is
                <code>text</code>, then initialize <em>event's</em>
                <code>data</code> attribute to the contents of
                <a href="#presentation-message-data">presentation message data</a> of type
                <code>DOMString</code>.
                </li>
                <li>If the <a href="#presentation-message-type">presentation message type</a> is
                <code>binary</code>, and <a href="#binarytype"><code>binaryType</code></a> is set to
                <code>blob</code>, then initialise <em>event</em>'s
                <code>data</code> attribute to a new <code>Blob</code> object
                that represents <a href="#presentation-message-data">presentation message data</a> as its
                raw data.
                </li>
                <li>If the <a href="#presentation-message-type">presentation message type</a> is
                <code>binary</code>, and <a href="#binarytype"><code>binaryType</code></a> is set to
                <code>arraybuffer</code>, then initialise <em>event</em>'s
                <code>data</code> attribute to a new <code>ArrayBuffer</code>
                object whose contents are <a href="#presentation-message-data">presentation message
                data</a>.
                </li>
              </ol>
            </li>
            <li>
              <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task">Queue a task</a> to
              <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/infrastructure.html#concept-event-fire" title="concept-event-fire">fire
              <em>event</em></a> at
              <a href="#presentationsession"><code>PresentationSession</code></a>.
            </li>
          </ol>
          <p class="open-issue">
            <a href="https://github.com/w3c/presentation-api/issues/63">ISSUE
            63: Define (cross) origin relationship between opener and
            presenting page</a>
          </p>
        </section>
        <section>
          <h4 id="closing-a-presentationsession"><span class="secno">6.3.3 </span>
            Closing a <a href="#presentationsession"><code>PresentationSession</code></a>
          </h4>
          <p>
            When the user agent is to <dfn id="close-algorithm" title="close-algorithm">close a
            presentation session S</dfn>, it must run the following steps:
          </p>
          <ol>
            <li>If <em>S.state</em> is not <code>connected</code>, then:
              <ol>
                <li>Abort these steps.
                </li>
              </ol>
            </li>
            <li>Set <em>S.state</em> to <code>disconnected</code>.
            </li>
            <li>Let <em>D</em> be the set of presentations known by the user
            agent.
            </li>
            <li>
              <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task">Queue a task</a> <em>T</em>
              to run the following steps in order:
              <ol>
                <li>For each presentation <em>(U, I, S')</em> in <em>D</em>,
                  <ol>
                    <li>Let <em>u</em> equal <em>U</em>, <em>i</em> equal <em>
                      I</em>, and <em>s</em> equal <em>S'</em>.
                    </li>
                    <li>If <em>u</em> is equal to <em>S.url</em> and <em>i</em>
                    is equal to <em>S.id</em>, run the following steps:
                      <ol>
                        <li>
                          <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task">Queue a task</a>
                          to <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/infrastructure.html#concept-event-fire" title="concept-event-fire">fire an event</a> named
                          <code>statechange</code> at <em>s</em>.
                        </li>
                      </ol>
                    </li>
                  </ol>
                </li>
              </ol>
            </li>
          </ol>
          <p class="open-issue">
            <a href="https://github.com/w3c/presentation-api/issues/35">ISSUE
            35: Refine how to do session teardown/disconnect/closing</a>
          </p>
        </section>
        <section>
          <h4 id="event-handlers"><span class="secno">6.3.4 </span>
            Event Handlers
          </h4>
          <p>
            The following are the event handlers (and their corresponding event
            handler event types) that must be supported, as event handler IDL
            attributes, by objects implementing the
            <a href="#presentationsession"><code>PresentationSession</code></a> interface:
          </p>
          <table>
            <thead>
              <tr>
                <th>
                  Event handler
                </th>
                <th>
                  Event handler event type
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <dfn id="onmessage"><code>onmessage</code></dfn>
                </td>
                <td>
                  <code>message</code>
                </td>
              </tr>
              <tr>
                <td>
                  <dfn id="onstatechange"><code>onstatechange</code></dfn>
                </td>
                <td>
                  <code>statechange</code>
                </td>
              </tr>
            </tbody>
          </table>
        </section>
      </section>
      <section>
        <h3 id="interface-navigatorpresentation"><span class="secno">6.4 </span>
          Interface <a href="#navigatorpresentation"><code>NavigatorPresentation</code></a>
        </h3>
        <pre class="idl">partial interface <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#navigator">Navigator</a> {
  readonly attribute <a href="#navigatorpresentation">NavigatorPresentation</a> <a href="#presentation">presentation</a>;
};
</pre>
        <p>
          The <dfn id="presentation"><code>presentation</code></dfn> attribute is used to
          retrieve an instance of the <a href="#navigatorpresentation"><code>NavigatorPresentation</code></a>
          interface, the main interface of Presentation API.
        </p>
        <pre class="idl">interface <dfn id="navigatorpresentation">NavigatorPresentation</dfn> : EventTarget {
  readonly attribute <a href="#presentationsession">PresentationSession</a>? <span>session</span>;
  Promise&lt;<a href="#presentationsession">PresentationSession</a>&gt; <a href="#startsession">startSession</a>(DOMString url, DOMString? presentationId);
  Promise&lt;<a href="#presentationsession">PresentationSession</a>&gt; <a href="#joinsession">joinSession</a>(DOMString url, DOMString? presentationId);
  attribute <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#eventhandler">EventHandler</a> <a href="#onavailablechange">onavailablechange</a>;
  attribute <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#eventhandler">EventHandler</a> <span>ondefaultsessionstart</span>;
};
</pre>
        <p class="open-issue">
          <a href="https://github.com/w3c/presentation-api/issues/52">ISSUE 52:
          Specify the NavigatorPresentation.session attribute and its related
          algorithms</a>
        </p>
        <section>
          <h4 id="starting-a-presentation-session"><span class="secno">6.4.1 </span>
            Starting a presentation session
          </h4>
          <p>
            When the <code><dfn id="startsession">startSession</dfn>(presentationUrl,
            presentationId)</code> method is called, the user agent must run
            the following steps:
          </p>
          <dl>
            <dt>
              Input
            </dt>
            <dd>
              <code>presentationUrl</code>, the <a class="external" data-anolis-spec="url" href="https://url.spec.whatwg.org/#url">URL</a> of the document to be presented
            </dd>
            <dd>
              <code>presentationId</code>, an optional identifier for the
              presentation
            </dd>
            <dt>
              Output
            </dt>
            <dd>
              <em>P</em>, a <a class="external" data-anolis-spec="es6" href="https://people.mozilla.org/~jorendorff/es6-draft.html#sec-promise-objects" title="promise-objects">Promise</a>
            </dd>
          </dl>
          <ol>
            <li>Let <em>P</em> be a new <a class="external" data-anolis-spec="es6" href="https://people.mozilla.org/~jorendorff/es6-draft.html#sec-promise-objects" title="promise-objects">Promise</a>.
            </li>
            <li>Return <em>P</em>.
            </li>
            <li>If the user agent does not <span>monitor presentation display
            availability</span>, run the following steps:
              <ol>
                <li>
                  <span>Monitor presentation display availability</span>.
                </li>
                <li>Wait until the algorithm completes.
                </li>
              </ol>
            </li>
            <li>If the <a href="#list-of-available-presentation-displays">list of available presentation displays</a> is
            empty, then:
              <ol>
                <li>
                  <a class="external" data-anolis-spec="promguide" href="http://www.w3.org/2001/tag/doc/promises-guide#shorthand-manipulating" title="resolve-reject">Reject</a> <em>P</em> with a
                  <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#domexception" title="domexception">DOMException</a> named
                  <code>"NotFoundError"</code>.
                </li>
                <li>Abort all remaining steps.
                </li>
              </ol>
            </li>
            <li>Queue a task <em>T</em> to request user permission for the use
            of a <a data-anolis-ref="presentation" href="#presentation-display">presentation
            display</a> and selection of one presentation display.
              <ol>
                <li>If <em>T</em> completes with the user <em>granting
                permission</em> to use a display, run the following steps:
                  <ol>
                    <li>If <code>presentationId</code> is not
                    <em>undefined</em>, assign <em>I</em> to that that
                    <code>presentationId</code>.
                    </li>
                    <li>If <code>presentationId</code> is
                    <code>undefined</code>, let <em>I</em> be a random
                    alphanumeric value of at least 16 characters drawn from the
                    characters <code>[A-Za-z0-9]</code>.
                    </li>
                    <li>Create a new <a href="#presentationsession"><code>PresentationSession</code></a>
                    <em>S</em>.
                    </li>
                    <li>Set <code>S.url</code> to <code>presentationUrl</code>,
                    set <code>S.id</code> to <em>I</em>, and set
                    <code>S.state</code> to <code>disconnected</code>.
                    </li>
                    <li>
                      <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task">Queue a task</a>
                      <em>C</em> to create a new <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#browsing-context">browsing context</a> on the user-selected
                      <a href="#presentation-display">presentation display</a> and
                      <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/browsers.html#navigate">navigate</a> to
                      <code>presentationUrl</code> in it.
                      <ol>
                        <li>If <em>C</em> completes successfully, run the
                        following steps:
                          <ol>
                            <li>Add <em>(S.url, S.id, S)</em> to <em>D</em>.
                            </li>
                            <li>
                              <a class="external" data-anolis-spec="promguide" href="http://www.w3.org/2001/tag/doc/promises-guide#shorthand-manipulating" title="resolve-reject">Resolve</a> <em>P</em> with
                              <em>S</em>.
                            </li>
                            <li>
                              <a href="#establish-a-presentation-connection">Establish a presentation connection</a>
                              with <em>S</em>.
                            </li>
                          </ol>
                        </li>
                        <li>If <em>C</em> fails, run the following steps:
                          <ol>
                            <li>
                              <a class="external" data-anolis-spec="promguide" href="http://www.w3.org/2001/tag/doc/promises-guide#shorthand-manipulating" title="resolve-reject">Reject</a> P with a
                              <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#domexception" title="domexception">DOMException</a> named
                              <code>"OperationError"</code>.
                            </li>
                          </ol>
                        </li>
                      </ol>
                    </li>
                  </ol>
                </li>
                <li>If <em>T</em> completes with the user <em>denying
                permission</em>, run the following steps:
                  <ol>
                    <li>
                      <a class="external" data-anolis-spec="promguide" href="http://www.w3.org/2001/tag/doc/promises-guide#shorthand-manipulating" title="resolve-reject">Reject</a> <em>P</em> with a
                      <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#domexception" title="domexception">DOMException</a> named
                      <code>"AbortError"</code>.
                    </li>
                  </ol>
                </li>
              </ol>
            </li>
          </ol>
          <p class="note">
            The details of implementing the permission request and display
            selection are left to the user agent; for example it may show the
            user a dialog and allow the user to select an available display
            (granting permission), or cancel the selection (denying
            permission).
          </p>
          <p class="note">
            The <code>presentationUrl</code> should name a resource accessible
            to the local or a remote user agent. This specification defines
            behavior for <code>presentationUrl</code> using the
            <code>http</code> or <code>https</code> schemes; behavior for other
            schemes is not defined by this specification.
          </p>
          <p class="open-issue">
            ISSUE: Do we want to distinguish the permission-denied outcome from
            the no-screens-available outcome? Developers would be able to infer
            it anyway from <code>availablechange</code>.
          </p>
        </section>
        <section>
          <h4 id="joining-a-presentation-session"><span class="secno">6.4.2 </span>
            Joining a presentation session
          </h4>
          <p>
            When the <code><dfn id="joinsession">joinSession</dfn>(presentationUrl,
            presentationId)</code> method is called, the user agent must run
            the following steps:
          </p>
          <dl>
            <dt>
              Input
            </dt>
            <dd>
              <code>presentationUrl</code>, the <a class="external" data-anolis-spec="url" href="https://url.spec.whatwg.org/#url">URL</a> of the document being presented
            </dd>
            <dd>
              <code>presentationId</code>, the identifier for the presentation
            </dd>
            <dt>
              Output
            </dt>
            <dd>
              <em>P</em>, a <a class="external" data-anolis-spec="es6" href="https://people.mozilla.org/~jorendorff/es6-draft.html#sec-promise-objects" title="promise-objects">Promise</a>
            </dd>
          </dl>
          <ol>
            <li>Let <em>P</em> be a new <a class="external" data-anolis-spec="es6" href="https://people.mozilla.org/~jorendorff/es6-draft.html#sec-promise-objects" title="promise-objects">Promise</a>.
            </li>
            <li>Return <em>P</em>.
            </li>
            <li>Let <em>D</em> be the set of presentations known by the user
            agent.
            </li>
            <li>
              <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task">Queue a task</a> <em>T</em>
              to run the following steps in order:
              <ol>
                <li>For each presentation <em>(U, I, S)</em> in <em>D</em>,
                  <ol>
                    <li>Let <em>u</em> equal <em>U</em>, <em>i</em> equal <em>
                      I</em>, and <em>s</em> equal <em>S</em>.
                    </li>
                    <li>If <em>u</em> is equal to <code>presentationUrl</code>
                    and <em>i</em> is equal to <code>presentationId</code>, run
                    the following steps:
                      <ol>
                        <li>
                          <a class="external" data-anolis-spec="promguide" href="http://www.w3.org/2001/tag/doc/promises-guide#shorthand-manipulating" title="resolve-reject">Resolve</a> <em>P</em> with
                          <em>S</em>.
                        </li>
                        <li>
                          <a href="#establish-a-presentation-connection">Establish a presentation connection</a> with
                          <em>S</em>.
                        </li>
                        <li>Abort the remaining steps of <em>T</em>.
                        </li>
                      </ol>
                    </li>
                  </ol>
                </li>
                <li>
                  <a class="external" data-anolis-spec="promguide" href="http://www.w3.org/2001/tag/doc/promises-guide#shorthand-manipulating" title="resolve-reject">Reject</a> <em>P</em> with a
                  <a class="external" data-anolis-spec="dom" href="https://dom.spec.whatwg.org/#domexception" title="domexception">DOMException</a> named
                  <code>"NotFoundError"</code>.
                </li>
              </ol>
            </li>
          </ol>
          <p class="open-issue">
            ISSUE: If no matching presentation is found, we could leave the
            Promise pending in case a matching presentation is started in the
            future.
          </p>
        </section>
        <section>
          <h4 id="establishing-a-presentation-connection"><span class="secno">6.4.3 </span>
            Establishing a presentation connection
          </h4>
          <p>
            When the user agent is to <dfn id="establish-a-presentation-connection">establish a presentation
            connection</dfn> using a <a href="#presentation-session">presentation session</a>
            <em>S</em>, it must run the following steps:
          </p>
          <ol>
            <li>If <em>S.state</em> is <code>connected</code>, then:
              <ol>
                <li>Abort all remaining steps.
                </li>
              </ol>
            </li>
            <li>
              <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task">Queue a task</a> <em>T</em>
              to connect <em>S</em> to the document that is presenting
              <em>S.url</em>.
            </li>
            <li>If <em>T</em> completes successfully, run the following steps:
              <ol>
                <li>Set <em>S.state</em> to <code>connected.</code>
                </li>
                <li>Let <em>D</em> be the set of presentations known by the
                user agent.
                </li>
                <li>Queue a task <em>T</em> to run the following steps in
                order:
                  <ol>
                    <li>For each presentation <em>(U, I, S')</em> in
                    <em>D</em>,
                      <ol>
                        <li>Let <em>u</em> equal <em>U</em>, <em>i</em> equal
                        <em>I</em>, and <em>s</em> equal <em>S'</em>.
                        </li>
                        <li>If <em>u</em> is equal to <em>S.url</em> and
                        <em>i</em> is equal to <em>S.id</em>, run the following
                        steps:
                          <ol>
                            <li>
                              <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task">Queue a
                              task</a> to <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/infrastructure.html#concept-event-fire" title="concept-event-fire">fire an event</a>
                              named <code>statechange</code> at <em>s</em>.
                            </li>
                          </ol>
                        </li>
                      </ol>
                    </li>
                  </ol>
                </li>
              </ol>
            </li>
          </ol>
          <p class="note">
            The mechanism that is used to present on the remote display and
            connect the <a href="#controlling-browsing-context">controlling browsing context</a> with the
            presented document is an implementation choice of the user agent.
            The connection must provide a two-way messaging abstraction capable
            of carrying <code>DOMString</code> payloads in a reliable and
            in-order fashion as described in the <em>Send Message</em> and
            <em>Receive Message</em> steps below.
          </p>
          <p class="note">
            If <em>T</em> does not complete successfully, the user agent may
            choose to re-execute the Presentation Connection algorithm at a
            later time.
          </p>
          <p class="open-issue">
            ISSUE: Do we want to notify the caller of a failure to connect,
            i.e. with an "error" onstatechange?
          </p>
          <p class="open-issue">
            ISSUE: Do we want to pass the new state as a property of the
            statechange event?
          </p>
        </section>
        <section>
          <h4 id="establishing-a-presentation-connection-on-presenting-page"><span class="secno">6.4.4 </span>
            Establishing a presentation connection on presenting page
          </h4>
          <p>
            When a new browser context created on a user-selected presentation
            display, user agent is to establish a presentation connection to
            controlling page, it must run the following steps:
          </p>
          <ol>
            <li>Set <em>NavigatorPresentation.session</em> to
            <code>undefined</code>.
            </li>
            <li>Create new <a href="#presentationsession"><code>PresentationSession</code></a> <em>S</em>.
            </li>
            <li>Let <em>I</em> be a random alphanumeric value of at least 16
            characters drawn from the characters <code>[A-Za-z0-9]</code>.
            </li>
            <li>Set <code>S.state</code> to <code>disconnect</code> and <code>
              S.id</code> to<em>I</em>
            </li>
            <li>Set <code>NavigatorPresentation.session</code> to
            <em>S</em><code>.</code>
            </li>
            <li>
              <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task">Queue a task</a> <em>T</em>
              to connect <em>S</em> to the controlling browsing context using
              implementation specific mechanism.
            </li>
            <li>If <em>T</em> completes successfully, run the following steps:
              <ol>
                <li>Set <code>S.state</code> to <code>connected</code>.
                </li>
                <li>
                  <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task">Queue a task</a> to
                  <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/infrastructure.html#concept-event-fire" title="concept-event-fire">fire an event</a> named statechange
                  at <em>S</em>.
                </li>
              </ol>
            </li>
          </ol>
        </section>
        <section>
          <h4 id="the-onavailablechange-eventhandler"><span class="secno">6.4.5 </span>
            The <a href="#onavailablechange"><code>onavailablechange</code></a> EventHandler
          </h4>
          <p>
            <span>The following are the event handlers (and their corresponding
            event handler event types) that must be supported, as event handler
            IDL attributes, by objects implementing the
            <a href="#navigatorpresentation"><code>NavigatorPresentation</code></a> interface:</span>
          </p>
          <table>
            <thead>
              <tr>
                <th>
                  Event handler
                </th>
                <th>
                  Event handler event type
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <dfn id="onavailablechange"><code>onavailablechange</code></dfn>
                </td>
                <td>
                  <code>availablechange</code>
                </td>
              </tr>
            </tbody>
          </table>
          <p>
            In order to satisfy the <a href="https://github.com/w3c/presentation-api/blob/gh-pages/uc-req.md#req08-power-saving-friendly">
            power saving non-functional requirement</a>, the user agent must
            keep track of the number of <code>EventHandler</code>s registered
            to the <code>availablechange</code> event. Using this information,
            implementation specific discovery of <span title="presentation-display">presentation displays</span> can be resumed
            or suspended, in order to save power.
          </p>The user agent must keep a <dfn id="list-of-available-presentation-displays">list of available presentation
          displays</dfn>. According to the number of event handlers for
          <code>availablechange</code>, the user agent must also keep the list
          up to date by running the algorithm for <a href="#algorithm-monitor-available" title="algorithm-monitor-available">monitoring the list of available
          presentation displays</a>.
          <section>
            <h5 id="adding-an-eventhandler-to-onavailablechange"><span class="secno">6.4.5.1 </span>
              Adding an <code>EventHandler</code> to
              <a href="#onavailablechange"><code>onavailablechange</code></a>
            </h5>
            <p>
              When an event handler is added to the list of event handlers
              registered for the <code>availablechange</code> event, the user
              agent must run the <a href="#algorithm-monitor-available" title="algorithm-monitor-available">algorithm to monitor the list of
              available presentation displays</a>.
            </p>
          </section>
          <section>
            <h5 id="removing-an-eventhandler"><span class="secno">6.4.5.2 </span>
              Removing an <code>EventHandler</code>
            </h5>
            <p>
              When an event handler is removed from the list of event handlers
              registered to the <code>availablechange</code> event, the user
              agent must run the following steps:
            </p>
            <ul>
              <li>If the removed event handler was the last one in the list,
              <a href="#cancel-monitoring-the-list-of-available-presentation-displays">cancel monitoring the list of available presentation
              displays</a>.
              </li>
            </ul>
          </section>
          <section>
            <h5 id="monitoring-the-list-of-available-presentation-displays"><span class="secno">6.4.5.3 </span>
              Monitoring the list of available presentation displays
            </h5>
            <p>
              When the user agent is to <dfn id="algorithm-monitor-available" title="algorithm-monitor-available">monitor the list of available
              presentation displays</dfn>, it must run the following steps:
            </p>
            <p>
              While there are <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#event-handlers">event
              handlers</a> added to NavigatorPresentation.onavailablechange,
              the user agent must continuously keep track the <a href="#list-of-available-presentation-displays">list of
              available presentation displays</a> and repeat the following
              steps:
            </p>
            <ol>
              <li>
                <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task">Queue a task</a> to
                retrieve the list of curently available <a href="#presentation-display">presentation displays</a> and let
                <a id="newdisplays"><em>newDisplays</em></a> be this list.
              </li>
              <li>Wait for the completion of that task.
              </li>
              <li>If the <a href="#list-of-available-presentation-displays">list of available presentation displays</a>
              is empty and <a href="#newdisplays">newDisplays</a> is not empty,
              then
                <ol>
                  <li>
                    <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task">Queue a task</a> to
                    <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/infrastructure.html#concept-event-fire" title="concept-event-fire">fire an event</a> named
                    <code>availablechange</code> at
                    <a href="#navigatorpresentation"><code>NavigatorPresentation</code></a> with the event's
                    <code>available</code> property set to <code>true</code>.
                  </li>
                </ol>
              </li>
              <li>If the <a href="#list-of-available-presentation-displays">list of available presentation displays</a>
              is not empty and <a href="#newdisplays">newDisplays</a> is empty,
              then:
                <ol>
                  <li>
                    <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task">Queue a task</a> to
                    <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/infrastructure.html#concept-event-fire" title="concept-event-fire">fire an event</a> named
                    <code>availablechange</code> at
                    <a href="#navigatorpresentation"><code>NavigatorPresentation</code></a> with the event's
                    <code>available</code> property set to <code>false</code>.
                  </li>
                </ol>
              </li>
              <li>Set the <a href="#list-of-available-presentation-displays">list of available presentation displays</a>
              to the value of <a href="#newdisplays">newDisplays</a>.
              </li>
            </ol>
            <p class="note">
              The mechanism used to monitor <a href="#presentation-display">presention displays</a> availability is
              left to the user agent. The user agent may choose search for
              displays at any time, not just when event handlers are added to
              <code>NavigatorPresentation.onavailablechange</code>.
            </p>
            <p>
              When the user agent is to <dfn id="cancel-monitoring-the-list-of-available-presentation-displays">cancel monitoring the list of
              available presentation displays</dfn>, it must run the following
              steps:
            </p>
            <ol>
              <li>Cancel any tasks to retrieve the list of available
              <a href="#presentation-display" title="presentation display">presentation displays</a>.
              </li>
              <li>Set the <a href="#list-of-available-presentation-displays">list of available presentation displays</a>
              to empty.
              </li>
              <li>
                <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/webappapis.html#queue-a-task">Queue a task</a> to
                <a class="external" data-anolis-spec="w3c-html" href="http://www.w3.org/html/wg/drafts/html/master/infrastructure.html#concept-event-fire" title="concept-event-fire">fire an event</a> named
                <code>availablechange</code> at
                <a href="#navigatorpresentation"><code>NavigatorPresentation</code></a> with the event's
                <code>available</code> property set to <code>false</code>.
              </li>
            </ol>
          </section>
        </section>
      </section>
      <section>
        <h3 id="interface-availablechangeevent"><span class="secno">6.5 </span>
          <span>Interface <a href="#availablechangeevent"><code>AvailableChangeEvent</code></a></span>
        </h3>
        <pre class="idl"><span>[Constructor(DOMString type, optional <a href="#availablechangeeventinit">AvailableChangeEventInit</a> eventInitDict)]
interface <dfn id="availablechangeevent">AvailableChangeEvent</dfn> : Event {
  readonly attribute boolean available;
};

dictionary <dfn id="availablechangeeventinit">AvailableChangeEventInit</dfn> : EventInit {
  boolean available;
};
</span>
</pre>
        <p>
          An event named <code>availablechange</code> is fired during the
          execution of the <span>monitoring presentation display
          availability</span> algorithm when the <dfn id="presentation-display-availability">presentation display
          availability</dfn> changes. It is fired at the
          <a href="#navigatorpresentation"><code>NavigatorPresentation</code></a> object, using the
          <a href="#availablechangeevent"><code>AvailableChangeEvent</code></a> interface, with the
          <code>available</code> attribute set to the boolean value that the
          algorithm determined.
        </p>
      </section>
      <section>
        <h3 id="interface-defaultsessionstart"><span class="secno">6.6 </span>
          <span>Interface <code>DefaultSessionStart</code></span>
        </h3>
        <pre class="idl"><span>[Constructor(DOMString type, optional <a href="#defaultsessionstarteventinit">DefaultSessionStartEventInit</a> eventInitDict)]
interface <dfn id="defaultsessionstartevent">DefaultSessionStartEvent</dfn> : Event {
  readonly attribute PresentationSession session;
};

dictionary <dfn id="defaultsessionstarteventinit">DefaultSessionStartEventInit</dfn> : EventInit {
  PresentationSession session;
};
</span>


</pre>
        <p>
          An event named <code>defaultsessionstart</code> is fired when the UA
          initiates a presentation on behalf of the page. It is fired at the
          <a href="#navigatorpresentation"><code>NavigatorPresentation</code></a> object, using the
          <a href="#defaultsessionstartevent"><code>DefaultSessionStartEvent</code></a> interface, with the
          <code>session</code> attribute set to the
          <a href="#presentationsession"><code>PresentationSession</code></a> object provided by the
          UA.
        </p>
      </section>
    </section>
    <section>
      <h2 id="security-and-privacy-considerations"><span class="secno">7 </span>
        Security and privacy considerations
      </h2>
      <p class="open-issue">
        <a href="https://github.com/w3c/presentation-api/issues/45">ISSUE 45:
        Security and privacy considerations section</a>
      </p>
    </section>
    <section>
      <h2 id="references"><span class="secno">8 </span>
        References
      </h2>
      <div id="anolis-references"><dl><dt id="refsDOM">[DOM]
<dd><cite><a href="https://dom.spec.whatwg.org/">DOM</a></cite>, Anne van Kesteren, Aryeh Gregor and Ms2ger. WHATWG.

<dt id="refsES6">[ES6]
<dd><cite><a href="http://people.mozilla.org/~jorendorff/es6-draft.html">ECMA-262 6th Edition / Draft</a></cite>. ECMA / Jason Orendorff.

<dt id="refsFILEAPI">[FILEAPI]
<dd><cite><a href="http://dev.w3.org/2006/webapi/FileAPI/">File API</a></cite>, Arun Ranganathan and Jonas Sicking. W3C.

<dt id="refsHTML5">[HTML5]
<dd><cite><a href="http://www.w3.org/html/wg/drafts/html/CR/">HTML5</a></cite>, Robin Berjon, Steve Faulkner, Travis Leithead et al.. W3C.

<dt id="refsPROMGUIDE">[PROMGUIDE]
<dd><cite><a href="http://www.w3.org/2001/tag/doc/promises-guide">Writing Promise-Using Specifications</a></cite>, Domenic Denicola. W3C.

<dt id="refsRFC2119">[RFC2119]
<dd><cite><a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a></cite>, Scott Bradner. IETF.

<dt id="refsTYPEDARRAY">[TYPEDARRAY]
<dd><cite><a href="http://www.khronos.org/registry/typedarray/specs/latest/">Typed Array</a></cite>, David Herman and Kenneth Russel. Khronos.

<dt id="refsURL">[URL]
<dd><cite><a href="https://url.spec.whatwg.org/">URL</a></cite>, Anne van Kesteren. WHATWG.

<dt id="refsWEBIDL">[WEBIDL]
<dd><cite><a href="http://heycam.github.io/webidl/">Web IDL</a></cite>, Cameron McCormack. W3C.

</dl></div>
    </section>
    <section>
      <h2 id="acknowledgments"><span class="secno">9 </span>
        Acknowledgments
      </h2>
      <p>
        Thanks to Wayne Carr, Louay Bassbouss, Anssi Kostiainen, 闵洪波 (Hongbo
        Min), Anton Vayvod, and Mark Foltz for help with editing, reviews and
        feedback to this draft.
      </p>
    </section>
  

